---
import { Lock, Unlock, Copy, Check } from '@lucide/astro';

interface Props {
  color: string;
  locked?: boolean;
  index: number;
}

const { color, locked = false, index } = Astro.props;

// Calcular si el texto debe ser claro u oscuro
function getTextColor(hex: string): string {
  const r = parseInt(hex.slice(1, 3), 16);
  const g = parseInt(hex.slice(3, 5), 16);
  const b = parseInt(hex.slice(5, 7), 16);
  const luminance = (0.299 * r + 0.587 * g + 0.114 * b) / 255;
  return luminance > 0.5 ? '#000000' : '#FFFFFF';
}

const textColor = getTextColor(color);
---

<div
  class="color-card group relative rounded-2xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300 cursor-pointer"
  style={`background-color: ${color};`}
  data-color={color}
  data-index={index}
>
  <!-- Contenido de la tarjeta -->
  <div class="aspect-square flex flex-col items-center justify-center p-6 relative">
    <!-- C贸digo hex grande -->
    <div 
      class="text-2xl font-bold mb-2 tracking-wider"
      style={`color: ${textColor};`}
    >
      {color.toUpperCase()}
    </div>

    <!-- Botones de acci贸n -->
    <div class="flex gap-2 mt-4">
      <!-- Bot贸n copiar -->
      <button
        class="copy-btn p-2 rounded-lg backdrop-blur-sm transition-all hover:scale-110"
        style={`background-color: ${textColor === '#FFFFFF' ? 'rgba(255,255,255,0.2)' : 'rgba(0,0,0,0.2)'}; color: ${textColor};`}
        data-color={color}
        aria-label="Copiar color"
      >
        <Copy class="w-5 h-5 copy-icon" />
        <Check class="w-5 h-5 check-icon hidden" />
      </button>

      <!-- Bot贸n bloquear -->
      <button
        class="lock-btn p-2 rounded-lg backdrop-blur-sm transition-all hover:scale-110"
        style={`background-color: ${textColor === '#FFFFFF' ? 'rgba(255,255,255,0.2)' : 'rgba(0,0,0,0.2)'}; color: ${textColor};`}
        data-index={index}
        data-locked={locked}
        aria-label="Bloquear/Desbloquear color"
      >
        {locked ? (
          <Lock class="w-5 h-5" />
        ) : (
          <Unlock class="w-5 h-5" />
        )}
      </button>
    </div>

    <!-- Indicador de bloqueado -->
    {locked && (
      <div 
        class="absolute top-3 right-3 p-1.5 rounded-lg backdrop-blur-sm"
        style={`background-color: ${textColor === '#FFFFFF' ? 'rgba(255,255,255,0.3)' : 'rgba(0,0,0,0.3)'}; color: ${textColor};`}
      >
        <Lock class="w-4 h-4" />
      </div>
    )}
  </div>

  <!-- Input oculto para editar color -->
  <input
    type="color"
    class="color-input absolute opacity-0 pointer-events-none"
    value={color}
    data-index={index}
  />
</div>

<style>
  .color-card:active {
    transform: scale(0.98);
  }
</style>
